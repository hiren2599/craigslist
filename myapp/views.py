import requests
from requests.compat import quote_plus
from django.shortcuts import render
from bs4 import BeautifulSoup
from . import models

# Create your views here.

BASE_URL='https://ahmedabad.craigslist.org/search/?query={}'
BASE_URL_IMG='https://images.craigslist.org/{}_300x300.jpg'

def home(request):
    return render(request,'base.html')

def new_search(request):
    search=request.POST.get('search')
    models.Search.objects.create(search=search)
    
    final_url=BASE_URL.format(quote_plus(search))

    response=requests.get(final_url)
    data=response.text
    
    soup=BeautifulSoup(data,features='html.parser')
    post_listing=soup.find_all('li',{'class':'cl-static-search-result'})
    
    final_posting=[]
    for post in post_listing:
        post_title=post.find(class_='title').text
        post_url=post.find('a').get('href')
        
        if post.find(class_='price'):
            post_price=post.find(class_='price').text
        else:
            post_price='NA'

        post_image_url='data:image/jpeg;base64,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'
               
        final_posting.append((post_title,post_url,post_price,post_image_url))
    
    frontend_stuff={
        'search':search,
        'final_posting':final_posting,
    }
    return render(request,'myapp/new_search.html',frontend_stuff)
    
